using GeoStats
import Meshes: Point
import CoordRefSystems: LatLon
import Match: @match
import DataFrames: DataFrame
import GeoTables: GeoTable
import JSON: parsefile
import Base.Threads: @spawn

function build_place_table(dir::String)::GeoTable
    raw_places::Vector{Dict{String,Any}} = []
    for place in readdir(dir)
        push!(raw_places, parsefile(dir * place))
    end

    place_id::Vector{String} = []
    primary_type::Vector{String} = []
    geometry::Vector{Point} = []

    for place in raw_places
        push!(place_id, get(raw_places[575], "id", ""))
        push!(
            geometry, Point(LatLon{WGS84Latest}(place["location"]["latitude"], place["location"]["longitude"]))
        )
        push!(primary_type, get(place, "primaryType", ""))
    end

    table = DataFrame(; place_id=place_id, primary_type=primary_type)


    return georef(table, geometry)
end

map_top_place_category(category::String) = @match category begin
    "car_dealer" => "automotive"
    "car_rental" => "automotive"
    "car_repair" => "automotive"
    "car_wash" => "automotive"
    "electric_vehicle_charging_station" => "automotive"
    "gas_station" => "automotive"
    "parking" => "automotive"
    "rest_stop" => "automotive"
    "farm" => "business"
    "art_gallery" => "culture"
    "museum" => "culture"
    "performing_arts_theater" => "culture"
    "library" => "education"
    "preschool" => "education"
    "primary_schoolschool" => "education"
    "secondary_school" => "education"
    "university" => "education"
    "school" => "education"
    "amusement_center" => "recreation"
    "amusement_park" => "recreation"
    "aquarium" => "recreation"
    "banquet_hall" => "recreation"
    "bowling_alley" => "recreation"
    "casino" => "recreation"
    "community_center" => "recreation"
    "convention_center" => "recreation"
    "cultural_center" => "recreation"
    "dog_park" => "recreation"
    "event_venue" => "recreation"
    "hiking_area" => "recreation"
    "historical_landmark" => "recreation"
    "marina" => "recreation"
    "movie_rental" => "recreation"
    "movie_theater" => "recreation"
    "national_park" => "recreation"
    "night_club" => "recreation"
    "park" => "recreation"
    "tourist_attraction" => "recreation"
    "visitor_center" => "recreation"
    "wedding_venue" => "recreation"
    "zoo" => "recreation"
    "accounting" => "finance"
    "atm" => "finance"
    "bank" => "finance"
    "american_restaurant" => "foodbev"
    "bakery" => "foodbev"
    "bar" => "foodbev"
    "barbecue_restaurant" => "foodbev"
    "brazilian_restaurant" => "foodbev"
    "breakfast_restaurant" => "foodbev"
    "brunch_restaurant" => "foodbev"
    "cafe" => "foodbev"
    "chinese_restaurant" => "foodbev"
    "coffee_shop" => "foodbev"
    "fast_food_restaurant" => "foodbev"
    "french_restaurant" => "foodbev"
    "greek_restaurant" => "foodbev"
    "hamburger_restaurant" => "foodbev"
    "ice_cream_shop" => "foodbev"
    "indian_restaurant" => "foodbev"
    "indonesian_restaurant" => "foodbev"
    "italian_restaurant" => "foodbev"
    "japanese_restaurant" => "foodbev"
    "korean_restaurant" => "foodbev"
    "lebanese_restaurant" => "foodbev"
    "meal_delivery" => "foodbev"
    "meal_takeaway" => "foodbev"
    "mediterranean_restaurant" => "foodbev"
    "mexican_restaurant" => "foodbev"
    "middle_eastern_restaurant" => "foodbev"
    "pizza_restaurant" => "foodbev"
    "ramen_restaurant" => "foodbev"
    "restaurant" => "foodbev"
    "sandwich_shop" => "foodbev"
    "seafood_restaurant" => "foodbev"
    "spanish_restaurant" => "foodbev"
    "steak_house" => "foodbev"
    "sushi_restaurant" => "foodbev"
    "thai_restaurant" => "foodbev"
    "turkish_restaurant" => "foodbev"
    "vegan_restaurant" => "foodbev"
    "vegetarian_restaurant" => "foodbev"
    "vietnamese_restaurant" => "foodbev"
    "administrative_area_level_1" => "geographic"
    "administrative_area_level_2" => "geographic"
    "country" => "geographic"
    "locality" => "geographic"
    "postal_code" => "geographic"
    "school_district" => "geographic"
    "city_hall" => "government"
    "courthouse" => "government"
    "embassy" => "government"
    "fire_station" => "government"
    "local_government_office" => "government"
    "police" => "government"
    "post_office" => "government"
    "dental_clinic" => "health"
    "dentist" => "health"
    "doctor" => "health"
    "drugstore" => "health"
    "hospital" => "health"
    "medical_lab" => "health"
    "pharmacy" => "health"
    "physiotherapist" => "health"
    "spa" => "health"
    "bed_and_breakfast" => "lodging"
    "campground" => "lodging"
    "camping_cabin" => "lodging"
    "cottage" => "lodging"
    "extended_stay_hotel" => "lodging"
    "farmstay" => "lodging"
    "guest_house" => "lodging"
    "hostel" => "lodging"
    "hotel" => "lodging"
    "lodging" => "lodging"
    "motel" => "lodging"
    "private_guest_room" => "lodging"
    "resort_hotel" => "lodging"
    "rv_park" => "lodging"
    "church" => "worship"
    "hindu_temple" => "worship"
    "mosque" => "worship"
    "synagogue" => "worship"
    "barber_shop" => "services"
    "beauty_salon" => "services"
    "cemetery" => "services"
    "child_care_agency" => "services"
    "consultant" => "services"
    "courier_service" => "services"
    "electrician" => "services"
    "florist" => "services"
    "funeral_home" => "services"
    "hair_care" => "services"
    "hair_salon" => "services"
    "insurance_agency" => "services"
    "laundry" => "services"
    "lawyer" => "services"
    "locksmith" => "services"
    "moving_company" => "services"
    "painter" => "services"
    "plumber" => "services"
    "real_estate_agency" => "services"
    "roofing_contractor" => "services"
    "storage" => "services"
    "tailor" => "services"
    "telecommunications_service_provider" => "services"
    "travel_agency" => "services"
    "veterinary_care" => "services"
    "auto_parts_store" => "shopping"
    "bicycle_store" => "shopping"
    "book_store" => "shopping"
    "cell_phone_store" => "shopping"
    "clothing_store" => "shopping"
    "convenience_store" => "shopping"
    "department_store" => "shopping"
    "discount_store" => "shopping"
    "electronics_store" => "shopping"
    "furniture_store" => "shopping"
    "gift_shop" => "shopping"
    "grocery_store" => "shopping"
    "hardware_store" => "shopping"
    "home_goods_store" => "shopping"
    "home_improvement_store" => "shopping"
    "jewelry_store" => "shopping"
    "liquor_store" => "shopping"
    "market" => "shopping"
    "pet_store" => "shopping"
    "shoe_store" => "shopping"
    "shopping_mall" => "shopping"
    "sporting_goods_store" => "shopping"
    "store" => "shopping"
    "supermarket" => "shopping"
    "wholesaler" => "shopping"
    "athletic_field" => "shopping"
    "fitness_center" => "shopping"
    "golf_course" => "shopping"
    "gym" => "shopping"
    "playground" => "shopping"
    "ski_resort" => "shopping"
    "sports_club" => "shopping"
    "sports_complex" => "shopping"
    "stadium" => "shopping"
    "swimming_pool" => "shopping"
    "airport" => "transportation"
    "bus_station" => "transportation"
    "bus_stop" => "transportation"
    "ferry_terminal" => "transportation"
    "heliport" => "transportation"
    "light_rail_station" => "transportation"
    "park_and_ride" => "transportation"
    "subway_station" => "transportation"
    "taxi_stand" => "transportation"
    "train_station" => "transportation"
    "transit_depot" => "transportation"
    "transit_station" => "transportation"
    "truck_stop" => "transportation"
    "administrative_area_level_3" => "typeb"
    "administrative_area_level_4" => "typeb"
    "administrative_area_level_5" => "typeb"
    "administrative_area_level_6" => "typeb"
    "administrative_area_level_7" => "typeb"
    "archipelago" => "typeb"
    "colloquial_area" => "typeb"
    "continent" => "typeb"
    "establishment" => "typeb"
    "floor" => "typeb"
    "food" => "typeb"
    "general_contractor" => "typeb"
    "geocode" => "typeb"
    "health" => "typeb"
    "intersection" => "typeb"
    "landmark" => "typeb"
    "natural_feature" => "typeb"
    "neighborhood" => "typeb"
    "place_of_worship" => "typeb"
    "plus_code" => "typeb"
    "point_of_interest" => "typeb"
    "political" => "typeb"
    "post_box" => "typeb"
    "postal_code_prefix" => "typeb"
    "postal_code_suffix" => "typeb"
    "postal_town" => "typeb"
    "premise" => "typeb"
    "room" => "typeb"
    "route" => "typeb"
    "street_address" => "typeb"
    "street_number" => "typeb"
    "sublocality" => "typeb"
    "sublocality_level_1" => "typeb"
    "sublocality_level_2" => "typeb"
    "sublocality_level_3" => "typeb"
    "sublocality_level_4" => "typeb"
    "sublocality_level_5" => "typeb"
    "subpremise" => "typeb"
    "town_square" => "typeb"
    _ => ""
end
